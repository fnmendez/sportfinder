<div>
  <div>
    <h1>Match: <%= match.id %> </h1>
    <h2>Fecha: <%= match.displayDate %></h2>
    <% if (match.sport) { %>
      <h2>Deporte: <%= match.sport.name %></h2>
    <% } else { %>
      <h2>Deporte: Por definir</h2>
    <% } %>
    <% if (match.club) { %>
      <h2>Club: <%= match.club.name %>, <%= match.club.address %></h2>
      <button onclick="myMap()">¿Cómo llego?</button>
      <div id="googleMap"></div>
    <% } else { %>
      <h2>Club: Por definir </h2>
    <% } %>
  </div>
  <div>
    <h2>Inscritos:</h2>
    <ul>
      <% players.forEach(player => { %>
        <li>
          <%= player.user.username %>
          <% isCurrentPlayer = currentPlayer.id === player.id %>
          <% playerIsAdmin = player.isAdmin() %>
          <% if (playerIsAdmin) { %>
            (admin)
          <% } %>
          <% if (!isCurrentPlayer && currentPlayer.isAdmin() && !playerIsAdmin) { %>
            <form action="<%= promotePlayerUrl(player) %>" method="post">
              <input type="submit" value="Promover" />
            </form>
            <form action="<%= removePlayerUrl(player) %>" method="post">
              <input type="hidden" name="_method" value="delete" />
              <input type="submit" value="Eliminar" />
            </form>
          <% } else if (isCurrentPlayer) { %>
            <form action="<%= removePlayerUrl(player) %>" method="post">
              <input type="hidden" name="_method" value="delete" />
              <input type="submit" value="Abandonar" />
            </form>
          <% } %>
        </li>
      <% }) %>
    </ul>
  </div>
  <div>
    <a href="<%= editMatchUrl %> ">Editar</a>
  </div>
  <div>
    <form action="<%= indexUrl %>" method="get">
      <div>
        <input type="submit" value="Volver" />
      </div>
    </form>
  </div>
  <div>
    <form action="<%= deleteMatchUrl %>" method="post">
      <input type="hidden" name="_method" value="delete" />
      <input type="submit" value="Borrar" />
    </form>
  </div>
</div>
<% if (match.club) { %>
<script>
  function myMap() {
    document.getElementById('googleMap').style.display = 'block';
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var infoWindow = new google.maps.InfoWindow;
    var map = new google.maps.Map(document.getElementById("googleMap"),{
      center:new google.maps.LatLng(-33.4726,-70.6472),
      zoom:10,
    });
    directionsDisplay.setMap(map);
    // Try HTML5 Geolocation
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        directionsService.route({
          origin: pos,
          destination: "<%= match.club.name %>" + " " + "<%= match.club.address %>",
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter())
      });
    } else {
      handleLocationError(false, infoWindow, map.getCenter())
    }
  }
  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
                          'Error: La geolocalización falló.' :
                          'Error: Tu navegador no soporta geolocalización.');
    infoWindow.open(map);
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo9QsGpyoRHjiQrtuwgNYmO98VqcIiLS8"></script>
<% } %>
